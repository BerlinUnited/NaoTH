// test dribble with step control

option dribble_test {

  initial state search_ball {
    decision {
      if (ball.was_seen)
        goto go_to_ball;
      else
        stay;
    }
    action {
      head.control_mode = search_for_ball;
      head_control();
      
      motion.type = stand;
    }
  }

  state go_to_ball {
    decision {
      if(ball.time_since_last_seen > 1000)
      {
        goto search_ball;
      }
      //else if(action_done)
      else if (ball.was_seen
              && state_time > 500 // don't kick continuously
              && action_done
              //&& abs(value=atan2(y = ball.right_foot.preview.y, x = ball.right_foot.preview.x)) < 20
              //&& abs(value=ball.right_foot.preview.x - 170 * cos(angle=atan2(y = ball.right_foot.preview.y, x = ball.right_foot.preview.x))) < 40
              //&& abs(value=ball.right_foot.preview.y - 170 * sin(angle=atan2(y = ball.right_foot.preview.y, x = ball.right_foot.preview.x))) < 40
              )
       {
         goto kick_ball;
       }
      else
        stay;
    }
    action {
      head.control_mode = search_for_ball;
      head_control();
      
      //go_to_ball_cool(right_foot=true, distance=170);

      
      go_to_relative_point(rotation = atan2(y = ball.preview.y, x = ball.preview.x), 
                           x = ball.preview.x - 170 * cos(angle=atan2(y = ball.preview.y, x = ball.preview.x)), 
                           y = ball.preview.y - 170 * sin(angle=atan2(y = ball.preview.y, x = ball.preview.x)));
      
      motion.walk.coordinate = hip;
      motion.walk.stop_with_stand = false;

      motion.walk.offset.y = 10;
      motion.walk.offset.rot = 30;
      
      motion.walk.step_control.foot = none;
      motion.walk.style = normal;
    }
  }

  state kick_ball
  {
    decision {
      if(ball.time_since_last_seen > 1000)
      {
        goto search_ball;
      }
      else if(state_time > 500)
      {
        goto go_to_ball;
      }
      else
        stay;
    }
    action {
      head.control_mode = search_for_ball;
      head_control();

      motion.type = walk;
      //motion.walk_speed.x = 0;
      //motion.walk_speed.y = 0;
      //motion.walk_speed.rot = 0;
      motion.walk.coordinate = right_foot;
      motion.walk.step_control.foot = right;
      motion.walk.step_control.target.x = ball.right_foot.preview.x+100;
      motion.walk.step_control.target.y = ball.right_foot.preview.y;
      motion.walk.step_control.target.rot = 0;
      motion.walk.step_control.speed_direction = 90;
      motion.walk.step_control.time = 500;
      motion.walk.style = fast;
    }
  }
}