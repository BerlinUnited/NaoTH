/*
 * ConnectUI.java
 *
 * Created on 28. Februar 2008, 16:08
 */

package de.naoth.rc.server;

import java.io.IOException;
import java.util.Properties;
import javax.swing.JOptionPane;
import javax.swing.JPanel;

/**
 *
 * @author  thomas
 */
public class ConnectUI extends javax.swing.JPanel
{
  
  //private final Main parent;
  private MessageServer messageServer;
  private Properties properties;

  /** Creates new form ConnectUI */
  public ConnectUI() 
  {
    initComponents();  
  }

  public void init(MessageServer messageServer, Properties properties)
  {
    this.messageServer = messageServer;

    String host = properties.getProperty("hostname");
    if(host != null)
    {
      txtHost.setText(host);
    }

    String port = properties.getProperty("port");
    if(port != null)
    {
      txtPort.setText(port);
    }
  }

  public JPanel getPanel()
  {
    return this;
  }

  /**
   * Set the controls as if we are disconnected or not
   * @param isConnected
   */
  public void showConnected(boolean isConnected)
  {
    if(isConnected)
    {
      lblStatus.setText("connected to "+ messageServer.getAddress().toString());
    }
    else
    {
      lblStatus.setText("not connected");
    }
  }
  
  /** This method is called from within the constructor to
   * initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is
   * always regenerated by the Form Editor.
   */
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    txtHost = new javax.swing.JTextField();
    btConnect = new javax.swing.JButton();
    lblStatus = new javax.swing.JLabel();
    jLabel1 = new javax.swing.JLabel();
    txtPort = new javax.swing.JTextField();
    btDisconnect = new javax.swing.JButton();
    btAuto = new javax.swing.JButton();

    setPreferredSize(new java.awt.Dimension(582, 80));

    txtHost.setText("localhost");
    txtHost.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        txtHostActionPerformed(evt);
      }
    });

    btConnect.setMnemonic('C');
    btConnect.setText("Connect");
    btConnect.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btConnectActionPerformed(evt);
      }
    });

    lblStatus.setText("not connected");

    jLabel1.setText(":");

    txtPort.setText("5401");

    btDisconnect.setMnemonic('D');
    btDisconnect.setText("Disconnect");
    btDisconnect.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btDisconnectActionPerformed(evt);
      }
    });

    btAuto.setMnemonic('A');
    btAuto.setText("Auto");
    btAuto.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        btAutoActionPerformed(evt);
      }
    });

    javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
    this.setLayout(layout);
    layout.setHorizontalGroup(
      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
        .addContainerGap()
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
          .addGroup(layout.createSequentialGroup()
            .addComponent(txtHost, javax.swing.GroupLayout.PREFERRED_SIZE, 132, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGap(4, 4, 4)
            .addComponent(jLabel1)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
            .addComponent(txtPort, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(btConnect)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(btAuto)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(btDisconnect))
          .addComponent(lblStatus, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 558, Short.MAX_VALUE))
        .addContainerGap())
    );
    layout.setVerticalGroup(
      layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
      .addGroup(layout.createSequentialGroup()
        .addContainerGap()
        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
          .addComponent(txtHost, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
          .addComponent(jLabel1)
          .addComponent(txtPort, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
          .addComponent(btConnect)
          .addComponent(btDisconnect)
          .addComponent(btAuto))
        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
        .addComponent(lblStatus)
        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );
  }// </editor-fold>//GEN-END:initComponents

  private void txtHostActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtHostActionPerformed
    // TODO add your handling code here:
  }//GEN-LAST:event_txtHostActionPerformed

  private void btConnectActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btConnectActionPerformed
    
    try
    {
      this.messageServer.connect(txtHost.getText(), Integer.parseInt(txtPort.getText()));
      this.properties.put("hostname", txtHost.getText());
      this.properties.put("port", txtPort.getText());
    }
    catch (IOException ex)
    {
      /*Logger.getLogger(ImageViewer.class.getName()).log(Level.SEVERE,
        "Etablishing connection failed", ex);
			*/
      
      JOptionPane.showMessageDialog(this, 
        "Etablishing connection failed: " + ex.getLocalizedMessage(), "ERROR",
        JOptionPane.ERROR_MESSAGE);
    }
    
  }//GEN-LAST:event_btConnectActionPerformed

  private void btDisconnectActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btDisconnectActionPerformed
 
    this.messageServer.disconnect();
  }//GEN-LAST:event_btDisconnectActionPerformed

private void btAutoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAutoActionPerformed

  String host = txtHost.getText();
  boolean wasConnected = false;
  for(int currentPort = 5400; !wasConnected && currentPort <= 5403; currentPort++ )
  {
    try
    {
      txtPort.setText("" + currentPort);
      this.messageServer.connect(host, currentPort);
      wasConnected = true;
    }
    catch (IOException ex)
    {
      showConnected(false);
    }
  }
  
  for(int currentPort = 5500; !wasConnected && currentPort <= 5503; currentPort++ )
  {
    try
    {
      txtPort.setText("" + currentPort);
      this.messageServer.connect(host, currentPort);
      wasConnected = true;
    }
    catch (IOException ex)
    {
      showConnected(false);
    }
  }
  
  if(wasConnected)
  {
    this.properties.put("hostname", txtHost.getText());
    this.properties.put("port", txtPort.getText());
  }
  else
  {
          
    JOptionPane.showMessageDialog(this, 
      "Auto-Etablishing connection failed.", "ERROR", JOptionPane.ERROR_MESSAGE);
  }
}//GEN-LAST:event_btAutoActionPerformed

  
  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JButton btAuto;
  private javax.swing.JButton btConnect;
  private javax.swing.JButton btDisconnect;
  private javax.swing.JLabel jLabel1;
  private javax.swing.JLabel lblStatus;
  private javax.swing.JTextField txtHost;
  private javax.swing.JTextField txtPort;
  // End of variables declaration//GEN-END:variables
  
}
